<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>3D 弧形環繞抽卡 Demo - 滿版手機版</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #111;
    font-family: Arial, sans-serif;
  }

  #mobileScreen {
    width: 100vw;
    height: 100vh;
    background: url('13.jpg') no-repeat center center;
    background-size: cover;
    position: relative;
    overflow: hidden;
  }

  #cardContainer {
    width: 100%;
    height: 100%;
    perspective: 1000px;
    position: relative;
  }

  .cardGroup {
    width: 100%;
    height: 100%;
    position: absolute;
    transform-style: preserve-3d;
  }

  .card {
    width: 80px;
    height: calc(80px * 800 / 600);
    position: absolute;
    top: 50%;
    left: 50%;
    background-size: cover;
    background-position: center;
    border-radius: 12px;
    transform-style: preserve-3d;
    transition: opacity 1s ease, transform 1s ease;
    transform: translate(-50%, -50%) rotateY(0deg) translateZ(0px);
  }

  .centerCard {
    width: 140px;
    height: calc(140px * 800 / 600);
    position: absolute;
    top: 50%;
    left: 50%;
    background-size: cover;
    background-position: center;
    border-radius: 16px;
    box-shadow: 0 0 25px gold, 0 0 50px yellow;
    z-index: 10;
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.5);
    transition: opacity 1s ease, transform 1s ease;
  }

  .centerCard.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .star {
    position: absolute;
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    pointer-events: none;
    animation: flyStar 1.8s ease-out forwards;
  }

  @keyframes flyStar {
    to {
      transform: translate(var(--x), var(--y)) scale(0);
      opacity: 0;
    }
  }

  /* 測試用按鈕透明 */
  #startBtn {
    position: absolute;
    left: 50%;
    bottom: 50px;
    transform: translateX(-50%);
    width: 60%;
    max-width: 300px;
    height: 60px;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 9999;
  }

</style>
</head>
<body>

<div id="mobileScreen">
  <div id="cardContainer">
    <div class="cardGroup" id="cardGroup"></div>
  </div>
  <button id="startBtn"></button>
</div>

<script>
const backImage = '9.jpg';
const cardImages = ['1.jpg','2.jpg','3.jpg','4.jpg','5.jpg','6.jpg','8.jpg'];

function startDraw() {
  const group = document.getElementById("cardGroup");
  group.innerHTML = "";

  const total = 8;
  const cards = [];
  const screenWidth = window.innerWidth;

  for (let i = 0; i < total; i++) {
    const card = document.createElement("div");
    card.className = "card";
    card.style.backgroundImage = `url('${backImage}')`;
    const angle = (i / total) * 360;
    card.style.transform = `translate(-50%, -50%) rotateY(${angle}deg) translateZ(${screenWidth/2}px)`;
    group.appendChild(card);
    cards.push(card);
  }

  let rotation = 0;
  const rotateInterval = setInterval(() => {
    rotation += 3; // 旋轉速度
    group.style.transform = `rotateY(${rotation}deg)`;
  }, 20);

  setTimeout(() => {
    clearInterval(rotateInterval);
    cards.forEach(card => card.style.opacity = 0);
    const chosenIndex = Math.floor(Math.random() * cardImages.length);
    setTimeout(() => showCenterCard(cardImages[chosenIndex]), 500);
  }, 3000);
}

function showCenterCard(imageUrl) {
  const container = document.getElementById("cardContainer");
  const centerCard = document.createElement("div");
  centerCard.className = "centerCard";
  centerCard.style.backgroundImage = `url('${imageUrl}')`;
  container.appendChild(centerCard);
  requestAnimationFrame(() => centerCard.classList.add('show'));
  spawnStars(centerCard, 20);
}

function spawnStars(target, count) {
  const rect = target.getBoundingClientRect();
  for (let i = 0; i < count; i++) {
    const star = document.createElement("div");
    star.className = "star";
    star.style.left = `${rect.left + rect.width/2}px`;
    star.style.top = `${rect.top + rect.height/2}px`;
    const angle = Math.random() * 2 * Math.PI;
    const distance = 80 + Math.random() * 100;
    star.style.setProperty("--x", `${Math.cos(angle) * distance}px`);
    star.style.setProperty("--y", `${Math.sin(angle) * distance}px`);
    document.body.appendChild(star);
    setTimeout(() => star.remove(), 1800);
  }
}

// 透明按鈕觸發抽卡
document.getElementById('startBtn').addEventListener('click', startDraw);

</script>

</body>
</html>
