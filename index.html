<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>3D 弧形環繞抽卡 Demo - 滿版手機版</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: #111;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  /* 手機滿版容器 */
  #mobileScreen {
    width: 100vw;
    height: calc(var(--vh, 1vh) * 100); /* 使用 JS 計算的真實可見高度 */
    background: url('13.jpg') no-repeat center center;
    background-size: cover;
    position: relative;
    overflow: hidden;
  }

  #cardContainer {
    width: 100%;
    height: 100%;
    perspective: 1000px;
    position: relative;
  }

  .cardGroup {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) rotateY(0deg); /* 關鍵：先置中再旋轉 */
  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;
  will-change: transform;
}


  .card {
    width: 20vw;
    height: calc(20vw * 800 / 600); /* 保持比例 */
    position: absolute;
    top: 50%;
    left: 50%;
    background-size: cover;
    background-position: center;
    border-radius: 12px;
    transform-style: preserve-3d;
    transition: opacity 1s ease, transform 1s ease;
    background-color: red;
  }

  .centerCard {
    width: 80vw;
    height: calc(80vw * 800 / 600);
    position: absolute;
    top: 50%;
    left: 50%;
    background-size: cover;
    background-position: center;
    border-radius: 16px;
    box-shadow: 0 0 25px gold, 0 0 50px yellow;
    z-index: 10;
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.5);
    transition: opacity 1s ease, transform 1s ease;
  }

  .centerCard.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .star {
    position: absolute;
    width: 8px;
    height: 8px;
    background: white;
    border-radius: 50%;
    pointer-events: none;
    animation: flyStar 1.8s ease-out forwards;
  }

  @keyframes flyStar {
    to {
      transform: translate(var(--x), var(--y)) scale(0);
      opacity: 0;
    }
  }

  /* 抽卡按鈕透明可點 */

.drawButton {
  position: absolute;
  left: 52.04%;       /* 中心點 X / 1080 */
  top: 98%;        /* 中心點 Y / 1920 */
  transform: translate(-50%, -50%); /* 以中心點定位 */
  width: 71.29%;      /* 寬 / 1080 */
  height: 9.58%;      /* 高 / 1920 */
  background: transparent;
  border: none;
  cursor: pointer;
  z-index: 9999;
}
#overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0); /* 初始透明 */
  pointer-events: none;
  z-index: 1; /* 確保 centerCard 在上面 */
}


.cardGroup, .centerCard {
  position: absolute;
  z-index: 10; /* 確保卡牌在 overlay 上面 */
}




</style>
</head>
<body>
  <div id="mobileScreen">
    <div id="cardContainer">
      <div class="cardGroup" id="cardGroup"></div>
       <div id="overlay"></div>
    </div>
    <button class="drawButton" onclick="startDraw()"></button>
  </div>

<script>
/* 修正 iOS / Android 瀏覽器工具列影響高度 */
function setFullHeight() {
  document.documentElement.style.setProperty('--vh', window.innerHeight * 0.01 + 'px');
}
window.addEventListener('resize', setFullHeight);
setFullHeight();

const backImage = '9.jpg';
const cardImages = ['1.jpg','2.jpg','3.jpg','4.jpg','5.jpg','6.jpg','8.jpg'];

function startDraw() {
  const group = document.getElementById("cardGroup");
  group.innerHTML = "";

  const total = 8;
  const cards = [];

  for (let i = 0; i < total; i++) {
    const card = document.createElement("div");
    card.className = "card";
    card.style.backgroundImage = `url('${backImage}')`;
    const angle = (i / total) * 360;
    card.style.transform = `translate(-50%, -50%) rotateY(${angle}deg) translateZ(30vw)`;
    group.appendChild(card);
    cards.push(card);
  }

  let rotation = 0;
  const rotateInterval = setInterval(() => {
    rotation += 1;
    group.style.transform = `translate(-50%, -50%) rotateY(${rotation}deg)`;
  }, 20);

  setTimeout(() => {
    clearInterval(rotateInterval);
    cards.forEach(card => card.style.opacity = 0);
    const chosenIndex = Math.floor(Math.random() * cardImages.length);
    setTimeout(() => showCenterCard(cardImages[chosenIndex]), 500);
  }, 3000);
}

function showCenterCard(imageUrl) {
  const overlay = document.getElementById('overlay');
  overlay.style.background = 'rgba(0,0,0,0.4)'; // 抽卡後才變暗

  const container = document.getElementById("cardContainer");
  const centerCard = document.createElement("div");
  centerCard.className = "centerCard";
  centerCard.style.backgroundImage = `url('${imageUrl}')`;
  container.appendChild(centerCard);
  requestAnimationFrame(() => centerCard.classList.add('show'));
  spawnStars(centerCard, 20);
}


function spawnStars(target, count) {
  const rect = target.getBoundingClientRect();
  for (let i = 0; i < count; i++) {
    const star = document.createElement("div");
    star.className = "star";
    star.style.left = `${rect.left + rect.width/2}px`;
    star.style.top = `${rect.top + rect.height/2}px`;
    const angle = Math.random() * 2 * Math.PI;
    const distance = 80 + Math.random() * 100;
    star.style.setProperty("--x", `${Math.cos(angle) * distance}px`);
    star.style.setProperty("--y", `${Math.sin(angle) * distance}px`);
    document.body.appendChild(star);
    setTimeout(() => star.remove(), 1800);
  }
}
</script>
</body>
</html>
